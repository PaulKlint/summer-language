#					#
# if-then-else construction		#
#					#

include 'heading.sm';

program ifthen ()
( var x, y, z, n, a1, a2, n1 := 1, n2 := 2, n3 := 3;

  start('ifthen');
  test(n := 0);
  if n1 = 0 then error(n+0) fi;
  if n1 = 0 then error(n+1) else fi;
  if n1 = 0 then error(n+2)
  elif n1 = 2 then error(n+3) else fi;

  test(n := 10);
  if n1 = 0 | n1 = 2 then error(n+0) fi;
  if n1 = 0 | n1 = 2 | n1 = 3 | n1 = 4 then error(n+1) fi;
  if n1 = 0 | n1 = 2 | n1 = 3 | n1 = 4 then error(n+2) else fi;
  if n1 = 0 | n1 = 2 | n1 = 3 then error(n+3)
  elif n1 = 4 | n1 = 5 then error(n+4) else fi;

  test(n := 20);
  if n1 = 1 & n2 = 2 & n3 = 3 then else error(n+0) fi;
  if ~(n1 = 1 & n2 = 2 & n3 = 3) then error(n+1) fi;

  test(n := 30);
  if n1 = 1 then
     if n2 = 2 then else error(n+0) fi
  else
     error(n+1)
  fi;
  if n1 = 1 then
     if n2 = 3 then error(n+2) fi;
  else
     error(n+3)
  fi;
  if n1 = 2 then
     error(n+4)
  else
     if n2 = 2 then else error(n+5) fi;
  fi;
  if n1 = 2 then
     error(n+6)
  else
     if n2 = 3 then error(n+7) fi;
  fi;

  test(n := 40);
  if if n1 = 1 then 10 else 20 fi ~= 10 then error(n+0) fi;
  if if n1 ~= 1 then 10 else 20 fi ~= 20 then error(n+1) fi;
  if if n1 = 1 then 10 else 20 fi ~= if n1 ~= 1 then 20 else 10 fi
  then error(n+2) fi;

  test(n := 50);
  x := y := 1; z := 2;
  if x = y fails then error(n+0) fi;
  if x = z succeeds then error(n+1) fi;

  test(n := 60);
  a1 := [1, 2, 3];
  a2 := [10, 20, 30];
  x := if n1 = 1 then a1 else a2 fi[1];
  if x ~= 2 then error(n+0) fi;
  x := if n1 = 0 then a1 else a2 fi[1];
  if x ~= 20 then error(n+1) fi;
  if n1 = 1 then a1 else a2 fi[1] := 100;
  if a1[1] ~= 100 then error(n+2) fi;
  a1[1] := 2;
  if n1 = 0 then a1 else a2 fi[1] := 200;
  if a2[1] ~= 200 then error(n+3) fi;

  test(n := 70);
  x := 1; y := 2;
  if n1 = 1 then x else y fi := 0;
  if x ~= 0 | y ~= 2 then error(n+0) fi;
  x := 1;
  if n1 = 0 then x else y fi := 0;
  if x ~= 1 | y ~= 0 then error(n+1) fi;

  test(n := 80);
  x := 10; y := 20;
  if n1 = 1 then x else y fi := if 1 = 1 then 1 else 2 fi;
  if x ~= 1 | y ~= 20 then error(n+0) fi;
  x := 10;
  if n1 = 1 then x else y fi := if 1 = 0 then 1 else 2 fi;
  if x ~= 2 | y ~= 20 then error(n+1) fi;
  x := 10;
  if n1 = 0 then x else y fi := if n1 = 1 then 1 else 2 fi;
  if x ~= 10 | y ~= 1 then error(n+2) fi;
  y := 20;
  if n1 = 0 then x else y fi := if n1 = 0 then 1 else 2 fi;
  if x ~= 10 | y ~= 2 then error(n+3) fi;

  test(n := 90);
  if n1 = 2 then error(n+0)
  elif n1 = 2 | n2 = 2
  then # ok#
  else error(n+1)
  fi;

  test(n := 100);
  if   if n1 = 2 then n1 else n2 fi = 1 then error(n+0)
  elif if n1 = 2 then n2 else n1 fi = 2 then error(n+1)
  elif n1 = 1 then #ok #
  else error(n+2) fi;

  test(n := 110);
  if if n1 = 2 then n1 else n2 fi = 1 |
     if n1 = 2 then n2 else n1 fi = 2
  then error(n+0)
  elif n2 = 1 | ~(if n1 = 2 then n1 else n2 fi = 1)
  then # ok #
  else error(n+1)
  fi;

  test(n := 120);
  x := 0;
  while if n1 = 2 then n1 else n2 fi > x do x := x + 1 od;
  if x ~= 2 then error(n+0) fi;

  test(n := 130);
  if scan 'abc' for lit('x') rof then error(n+0) fi;
  if scan 'abc' for lit('x') rof | scan 'abc' for lit('a') rof
  then #ok#
  else error(n+1)
  fi;

  test(n := 140);
  x := '';
  if n1 = 1
  then
     if n1 = 1 & n2 = 2 then x := 'a' fi;
     if n2 = 2
     then
	if n1 = 1 & n2 = 2 then x := x || 'b' fi;
        if n3 = 3 
	then x := x || 'c'
	else error(n+0)
        fi;
	if n1 = 1
	then  x := x || 'd'
	else error(n+1)
	fi;
     else
	error(n+2)
     fi
  else
     error(n+3)
  fi;
  if x ~= 'abcd' then error(n+4) fi;
  finish('ifthen');
)
