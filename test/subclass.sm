var	last := '';

proc error(n) put('ERROR ', n, '\n');

class A(FsSe, FpSe)
begin	fetch	FsSe,
		FsSs,
		FsSp,
		FpSe: fetchFpSe,
		FpSs: fetchFpSs,
		FpSp: fetchFpSp,
		procF,
		_opE_,
		_opF_,
		read;
	store	FeSs,
		FeSp: storeFeSp,
		FsSs,
		FsSp: storeFsSp,
		FpSs,
		FpSp: storeFpSp;

	var FeSe := 0, FeSs := 1, FeSp := 2,
	   #FsSe = 3,# FsSs := 4, FsSp := 5,
	   #FpSe = 6,# FpSs := 7, FpSp := 8; 

	proc read(name)
	return( case name
		of	'FeSe': FeSe,
			'FeSs': FeSs,
			'FeSp': FeSp,
			'FsSe': FsSe,
			'FsSs': FsSs,
			'FsSp': FsSp,
			'FpSe': FpSe,
			'FpSs': FpSs,
			'FpSp': FpSp
		esac);


	proc fetchFpSe()
	(	last := 'FpSe'; return(FpSe));

	proc fetchFpSs()
	(	last := 'FpSs'; return(FpSs));

	proc fetchFpSp()
	(	last := 'FpSp'; return(FpSp));

	proc storeFeSp(v)
	(	last := 'FeSp'; return(FeSp := v));

	proc storeFsSp(v)
	(	last := 'FsSp'; return(FsSp := v));

	proc storeFpSp(v)
	(	last := 'FpSp'; return(FpSp := v));

	proc procF() last := 'procF';

	op _opF_ () last := '_opF_';

	proc procE() last := 'procE';

	op _opE_ () last := '_opE_';

	init:
		procE;
		if last ~= 'procE' then error(0) fi;
		_opE_ self;
		if last ~= '_opE_' then error(1) fi;
end A;

class A1(FsSe, FpSe, new)
begin	subclass of A;

	init:	if last ~= '_opE_' then error(2) fi;
		last := new
end A1;

class A2(FsSe, FpSe, new)
begin	subclass of A;
	fetch	FeSs,
		FeSp:	fetchFeSp,
		FsSp:	fetchFsSp,
		FpSs,
		FpSp:	fetchFpSp;

	store	FeSe:	storeFeSe,
		FeSs:	storeFeSs,
		FsSe,
		FsSp;

	var	FpSs, FpSp;

	proc fetchFeSp()
	(	last := 'FeSp'; return(FeSp));

	proc fetchFsSp()
	(	last := 'FsSp'; return(FsSp));

	proc storeFeSe(v)
	(	last := 'FeSe'; return(FeSe := v));

	proc storeFeSs(v)
	(	last := 'FeSs'; return(FeSs := v));

	init:	var n;

		if n := (FeSe ~= 0 | FeSs ~= 1 | FeSp ~= 2 |
		   	 FsSe ~= 3 | FsSs ~= 4 | FsSp ~= 5 |
		   	 FpSe ~= 6 | FpSs ~= 7 | FpSp ~= 8  )
		then	error(100+n)
		fi;
		procF;
		if last ~= 'procF' then error(110) fi;
		_opF_ self;
		if last ~= '_opF_' then error(111) fi;
		new := new + 1;
end A2;
	# redefinition scheme in A2:		#
	# associations between parentheses have #
	# not changed.				#
	# FeSe:	(fetch empty);  store proc.	#
	# FeSs: fetch simple;   store proc.	#
	# FeSp: fetch proc;     (store proc).	#
	# FsSe: (fetch simple); store simple.	#
	# FsSs: (fetch simple); (store simple).	#
	# FsSp: fetch proc;     store simple.	#
	# FpSe: (fetch proc);   (store empty).	#
	# FpSs: fetch simple;	store empty.	#
	# FpSp: (fetch proc);	store empty.	#

class A21(FsSe, FpSe, new)
begin	subclass of A2;

	fetch	FpSs: fetchFpSs;
	store	FpSs: storeFpSs;

	var FpSs := 11;

	proc fetchFpSs()
	(	last := 'FpSs_A2'; return(FpSs));

	proc storeFpSs(v)
	(	last := 'FpSs_A2'; return(FpSs := v));

	init:	var n;

		if n := (FeSe ~= 0 | FeSs ~= 1 | FeSp ~= 2 |
		   	 FsSe ~= 3 | FsSs ~= 4 | FsSp ~= 5 |
		   	 FpSe ~= 6 | FpSs ~= 7 | FpSp ~= 8  )
		then	error(200+n)
		fi;
# NB: The value of FpSs is unexpected. However, the initialisation of	#
# variables of this class is executed prior to the init-statement of the#
# superclass. Therefore, the superclass value 7 overrides the subclass	#
# value 11. This should be considered a known bug.			#
		new := new + 1;
		if new ~= 2 then error(212) fi;
end A21;

program subcl()
(	var a   := A  (3, 6),
	    a1  := A1 (3, 6, 0),
	    a2  := A2 (3, 6, 0),
	    a21 := A21(3, 6, 0),
	    x;

	x := a.read('FeSe');
	if x ~= 0 then error(300) fi;
	x := a.read('FeSs');
	if x ~= 1 then error(301) fi;
	x := a.read('FeSp');
	if x ~= 2 then error(302) fi;
	x := a.FsSe;
	if x ~= 3 then error(303) fi;
	x := a.FsSs;
	if x ~= 4 then error(304) fi;
	x := a.FsSp;
	if x ~= 5 then error(305) fi;
	x := a.FpSe;
	if x ~= 6 | last ~= 'FpSe' then error(306) fi;
	x := a.FpSs;
	if x ~= 7 | last ~= 'FpSs' then error(307) fi;
	x := a.FpSp;
	if x ~= 8 | last ~= 'FpSp' then error(308) fi;

	a.FeSs := 21;
	if a.read('FeSs') ~= 21 then error(309) fi;
	a.FeSp := 22;
	if last ~= 'FeSp' | a.read('FeSp') ~= 22 then error(310) fi;
	a.FsSs := 24;
	if a.FsSs ~= 24 then error(311) fi;
	a.FsSp := 25;
	if last ~= 'FsSp' | a.FsSp ~= 25 then error(312) fi;
	a.FpSs := 27;
	if a.FpSs ~= 27 then error(313) fi;
	a.FpSp := 28;
	if last ~= 'FpSp' | a.FpSp ~= 28 then error(314) fi;

	a.procF;
	if last ~= 'procF' then error(315) fi;
	_opF_ a;
	if last ~= '_opF_' then error(316) fi;
	
	
	x := a1.FsSe;
	if x ~= 3 then error(3155) fi;
	x := a1.FsSs;
	if x ~= 4 then error(3166) fi;
	x := a1.FsSp;
	if x ~= 5 then error(317) fi;
	x := a1.FpSe;
	if x ~= 6 | last ~= 'FpSe' then error(318) fi;
	x := a1.FpSs;
	if x ~= 7 | last ~= 'FpSs' then error(319) fi;
	x := a1.FpSp;
	if x ~= 8 | last ~= 'FpSp' then error(320) fi;

	a1.FeSs := 21;
	if a1.read('FeSs') ~= 21 then error(321) fi;
	a1.FeSp := 22;
	if last ~= 'FeSp' | a1.read('FeSp') ~= 22 then error(322) fi;
	a1.FsSs := 24;
	if a1.FsSs ~= 24 then error(323) fi;
	a1.FsSp := 25;
	if last ~= 'FsSp' | a1.FsSp ~= 25 then error(324) fi;
	a1.FpSs := 27;
	if a1.FpSs ~= 27 then error(325) fi;
	a1.FpSp := 28;
	if last ~= 'FpSp' | a1.FpSp ~= 28 then error(326) fi;

	a1.procF;
	if last ~= 'procF' then error(327) fi;
	_opF_ a1;
	if last ~= '_opF_' then error(328) fi;
	
	last := ''; x := a2.read('FeSe');
	if x ~= 0 | last ~= '' then error(329) fi;
	last := ''; x := a2.FeSp;
	if x ~= 2 | last ~= 'FeSp' then error(330) fi;
	last := ''; x := a2.FsSs;
	if x ~= 4 | last ~= '' then error(331) fi;
	last := ''; x := a2.FsSp;
	if x ~= 5 | last ~= 'FsSp' then error(332) fi;
	last := ''; x := a2.FpSs;
	if x ~= 7 | last ~= '' then error(333) fi;
	last := ''; x := a2.FpSp;
	if x ~= 8 | last ~= 'FpSp' then error(334) fi;

	last := ''; a2.FeSe := 21;
	if last ~= 'FeSe' | a2.read('FeSe') ~= 21 then error(335) fi;
	last := ''; a2.FeSs := 22;
	if last ~= 'FeSs' | a2.FeSs ~= 22 then error(336) fi;
	last := ''; a2.FeSp := 24;
	if last ~= 'FeSp' | a2.FeSp ~= 24 then error(337) fi;
	last := ''; a2.FsSe := 25;
	if last ~= '' | a2.FsSe ~= 25 then error(338) fi;
	last := ''; a2.FsSs := 27;
	if last ~= '' | a2.FsSs ~= 27 then error(339) fi;
	last := ''; a2.FsSp := 28;
	if last ~= '' | a2.FsSp ~= 28 then error(340) fi;

	a2.procF;
	if last ~= 'procF' then error(341) fi;
	_opF_ a2;
	if last ~= '_opF_' then error(342) fi;

	last := ''; x := a21.read('FeSe');
	if x ~= 0 | last ~= '' then error(343) fi;
	last := ''; x := a21.FeSp;
	if x ~= 2 | last ~= 'FeSp' then error(344) fi;
	last := ''; x := a21.FsSs;
	if x ~= 4 | last ~= '' then error(345) fi;
	last := ''; x := a21.FsSp;
	if x ~= 5 | last ~= 'FsSp' then error(346) fi;
	last := ''; x := a21.FpSs;
	if x ~=7 | last ~= 'FpSs_A2' then error(347) fi;
	last := ''; x := a21.FpSp;
	if x ~= 8 | last ~= 'FpSp' then error(348) fi;

	last := ''; a21.FeSe := 21;
	if last ~= 'FeSe' | a21.read('FeSe') ~= 21 then error(349) fi;
	last := ''; a21.FeSs := 22;
	if last ~= 'FeSs' | a21.FeSs ~= 22 then error(350) fi;
	last := ''; a21.FeSp := 24;
	if last ~= 'FeSp' | a21.FeSp ~= 24 then error(351) fi;
	last := ''; a21.FsSe := 25;
	if last ~= '' | a21.FsSe ~= 25 then error(352) fi;
	last := ''; a21.FsSs := 27;
	if last ~= '' | a21.FsSs ~= 27 then error(353) fi;
	last := ''; a21.FsSp := 28;
	if last ~= '' | a21.FsSp ~= 28 then error(354) fi;

	a21.procF;
	if last ~= 'procF' then error(341) fi;
	_opF_ a21;
	if last ~= '_opF_' then error(342) fi;
);

