proc error(n) put('\nERROR ', n, '\n');

proc work(n, abc, def, digits)
(

  if abc.text ~= 'abc' then error(n+1) fi;
  if abc.cursor ~= 0 then error(n+2) fi;
  scan def for
    if text ~= 'def' then error(n+3) fi;
    if subject.text ~= 'def' then error(n+4) fi;
    if abc.text ~= 'abc' then error(n+5) fi;
    if move(1) ~= 'd' then error(n+6) fi;
    if cursor ~= 1 then error(n+7) fi;
    if subject.cursor ~= 1 then error(n+8) fi;
    if abc.move(2) ~= 'ab' then error(n+9) fi;
    if abc.cursor ~= 2 then error(n+10) fi;
    if text ~= 'def' then error(n+11) fi;
    if cursor ~= 1 then error(n+12) fi;
  rof;
  scan abc
  for
     if text ~= 'abc' then error(n+13) fi;
     if subject.text ~= 'abc' then error(n+14) fi;
     if cursor ~= 2 then error(n+15) fi;
     if subject.cursor ~= 2 then error(n+16) fi;
  rof;
  scan digits
  for
     scan abc
     for
	if text ~= 'abc' then error(n+17) fi;
	if cursor ~= 2 then error(n+18) fi;
     rof;
     if text ~= '123456789' then error(n+19) fi;
     if cursor ~= 0 then error(n+20) fi;
  rof;
);

program scan_str2()
(var f_abc, f_def, f_dig;

  work(0, scan_string('abc'), scan_string('def'), scan_string('123456789'));
  work(20, scan_string('abc'), 'def', '123456789');
#
  f_abc := file('tmp.abc','w');
  f_abc.put('abc');
  f_abc.close ;
  f_abc := file('tmp.abc','r');
  f_def  := file('tmp.def','w'); 
  put('def');
  f_def.close ;
  f_def := file('tmp.def','r');
  f_dig := file('tmp.dig','w');
  f_dig.put('123456789');
  f_dig.close ;
  f_dig := file('tmp.dig','r');
  work(40, f_abc, f_def, f_dig);
#
)
