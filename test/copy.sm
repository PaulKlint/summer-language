#					#
# tcopy -- test copy function		#
#					#


proc error(n) put('ERROR: ', n, '\n');

class node(a, b)
begin fetch a, b;
      store a, b;
end node;
program tcopy()
( var a1, a2, t1, t2, x;

  x := 1;
  if x ~= copy(x) then error(1) fi;

  x := 1000;
  if x ~= copy(x) then error(2) fi;

  x := 'abcd';
  if x ~= copy(x) then error(3) fi;

#  x := error;#
#  if x ~= copy(x) then error(4) fi;#
##
#  x := copy;#
#  if x ~= copy(x) then error(5) fi;#

  a1 := [0, 1, 2];
  a2 := copy(a1);
  if a2[0] ~= 0 | a2[1] ~= 1 then error(6) fi;
  a2[0] := 100;
  if a1[0] ~= 0 | a2[0] ~= 100 then error(7) fi;

  t1 := table['a' : 'A', 'b' : 'B', 'c' : 'C', 'd' : 'D',
              'e' : 'E', 'f' : 'F', 'g' : 'G', 'h' : 'H',
              'i' : 'I', 'j' : 'J', 'k' : 'K', 'l' : 'L'];
  t2 := copy(t1);
  if t1.size ~= t2.size then error(8) fi;
  for x in t1.index do if t1[x] ~= t2[x] then error(9) fi od;
  for x in t2.index do if t2[x] ~= t1[x] then error(10) fi od;
  t2['b'] := 'BB';
  if t1['b'] ~= 'B' | t2['b'] ~= 'BB' then error(11) fi;
  t2['z'] := 'Z';
  if t1['z'] ~= undefined | t2['z'] ~= 'Z' then error(12) fi;

  t1 := table(5, 'DEFAULT');
  t1['a'] := 'A';
  t2 := copy(t1);
  if t2['a'] ~= 'A' | t2['x'] ~= 'DEFAULT' then error(11) fi;
  t2['b'] := 'B';
  if t1['b'] ~= 'DEFAULT' | t2['b'] ~= 'B' then error(12) fi;

  a1 := [0, 1, 2];
  a1[2] := a1;
  a2 := copy(a1);
  if a2[0] ~= 0 | a2[1] ~= 1 | type(a2[2]) ~= 'array' then error(13) fi;
  a1[0] := 100;
  a1[1] := 101;
  a1[2] := 102;
  if a2[2][0] ~= 0 | a2[2][1] ~= 1 | type(a2[2]) ~= 'array' then error(14) fi;

  a1 := node(1, 2);
  a2 := copy(a1);
  if type(a2) ~= 'node' | a2.a ~= 1 | a2.b ~= 2 then error(15) fi;
  a1.a := 10;
  if a2.a ~= 1 then error(16) fi;

  a1 := node(10, 20);
  a1.b := a1;
  a2 := copy(a1);
  if type(a2) ~= 'node' | type(a2.b) ~= 'node' | a2.a ~= 10 then error(17) fi;
  a1.a := 100;
  if a2.a ~= 10 then error(18) fi;
)
