proc do_match(this_model, ex)
( var i, pat, curs, action;

  model := this_model;
  put('---------------------------------- ', modelname[model], '\n\n');
  i := 0;
  while i < ex.size - 1
  do
     INITIAL_ENV    := environment();
     CURRENT_ENV    := environment();
     subject_string := ex[i];
     eval(ex[i+1]);
     pat     := ex[i+2];
     curs  := 0;
     put('\nsubject_string: ', subject_string, ' pattern: ', pat, '\n');
     if [curs, action, pat] := match(curs, null, pat) then
        put('succeeds;');
	put('cursor=', curs, ';action=', action, ';pat=', pat, '\n')
     else
        put('fails\n')
     fi;
     i := i + 3;
  od
);
program matchic (args)
( var i := 0, pat, curs, action, ex;
  ruletrace := if args.size > 0 then 1 else 0 fi;
  ex := [
	'abc',	'',	'''abc''',
	'abc',	'',	'''a''--''bc''',
	'ac',	'',	'''ab''|''ac''',
	'abe',	'',	'''ab''--(''c''|''e'')',
	'abe',	'',	'(''a''|''ab'')--''e''',
	'abe',	'',	'(''a''|''ab'')--(''c''|''e'')',
	'abc',	'',	'imsbas(''a'',x)',
	'abc',	'',	'cdsbas(''a'',x)',
	'aa',	'',	'imsbas(''a'',x)--(*x)',
	'abc',	'',	'imact(x:=''xxxx'')',
	'abc',	'',	'imact(x:=''abc'')--(*x)',
	'abc',	'',	'cdact(x:=''yy'')',
	'abc',	'',	'cdact(x:=''yy'')--''a''',
	'abc',	'',	'(cdact(x:=''yy'')--cdact(y:=''xx''))--cdact(z:=x)',
	'cd',	'',	'cdsbas((''b''|''c''),zzz)--''d''',
	'abc',	'',	'cdsbas((''a''|''ab''),zzz)--''c''',
	'abc',	'x:=''A'';y:=''B''',
		'((''a''--imact(x:=x+''A'')) | (''ab''--imact(x:=y+''B'')))--(imact(y:=y+''Y'')--''c'')',
	'aef',	'x:=''A'';y:=''B''',
                '((''a''--imact(x:=x+''A'')) | (''ab''--imact(x:=y+''B'')))--(imact(y:=y+''Y'')--''c'')'
	];
  do_match(IMMEDIATE_CONDITIONAL, ex);
)
