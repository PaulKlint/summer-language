.{{
    \jg\fBproc\fR \jh\fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIpat\fR)
\h'|\ngu'(  \ji\fBvar\fR \jj\fIcurs\fR1, \fIcurs\fR2, \fIexpr\fR1, \fIexpr\fR2, \fIP\fR, \fIP\fR1, \fIQ\fR, \fIQ\fR1;
\h'|\niu'\fBvar\fR \jj\fIrpat\fR1, \fIrpat\fR2, \fIstr\fR, \fIid\fR;
\h'|\niu'
\*#a\jk\*#\h'|\niu'\fBif\fR \jl{{ \fIpat\fR =\h'-0.3m'= \jm\fIP\fR:\*<pattern-primary\*> \*`\fI|\fR\^\*' \fIQ\fR:\*<pattern-primary\*> }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR1, \fImk\*_comp\fR\^(\fIcurs\fR, \fIexpr\fR, \fImk\*_alt\fR\^(\fIP\fR1, \fIQ\fR))]\^)
\h'|\nlu'\fBelif\fR \jo[\fIcurs\fR2, \fIexpr\fR2, \fIQ\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIQ\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR2, \fIexpr\fR2, \fImk\*_comp\fR\^(\fIcurs\fR, \fIexpr\fR, \fIQ\fR1)]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#b\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\fIP\fR:\*<pattern-primary\*> \*`\fI\(mi\h'-0.2m'\(mi\fR\^\*' \fIQ\fR:\*<pattern-primary\*> }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fBif\fR \jr[\fIcurs\fR2, \fIexpr\fR2, \fIQ\fR1] := \fImatch\fR\^(\fIcurs\fR1, \fIexpr\fR1, \fIQ\fR)
\h'|\nnu'\fBthen\fR
\h'|\nru'\fIrpat\fR1 := \fImk\*_comp\fR\^(\fIcurs\fR1, \fIexpr\fR1, \fIQ\fR1);
\h'|\nru'\fIrpat\fR2 := \fImk\*_subs\fR\^(\fImk\*_comp\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR1), \fIQ\fR);
\h'|\nru'\fIreturn\fR\^(\^[\fIcurs\fR2, \fIexpr\fR2, \fImk\*_alt\fR\^(\fIrpat\fR1, \fIrpat\fR2)]\^)
\h'|\nnu'\fBelse\fR
\h'|\nru'\fBif\fR \js\fIP\fR1 \(ap\h'-0.2m'= \fInull\fR
\h'|\nru'\fBthen\fR
\h'|\nsu'\fBif\fR \jq[\fIcurs\fR2, \fIexpr\fR2, \fIQ\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fImk\*_subs\fR\^(\fIP\fR1, \fIQ\fR))
\h'|\nsu'\fBthen\fR
\h'|\nqu'\fIreturn\fR\^(\^[\fIcurs\fR2, \fIexpr\fR2, \fIQ\fR1]\^)
\h'|\nsu'\fBfi\fR
\h'|\nru'\fBfi\fR
\h'|\nnu'\fBfi\fR
\h'|\nlu'\fBfi\fR;
\h'|\nlu'\fIfreturn\fR
\*#c\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\*`\fI\z( \jt\fR\^\*' \fIP\fR:\*<pattern\*> \*`\fI)\fR\^\*' }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fIreturn\fR\^(\fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR))
\*#d\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\fIstr\fR:\*<string-literal\*> }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn\fIcurs\fR1 := \fIlitmatch\fR\^(\fIcurs\fR, \fIstr\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR, \fInull\fR\|]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#e\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\fIid\fR:\*<identifier\*> }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fIP\fR := \fIINITIAL\*_ENV\fR.\fIbinding\fR\^(\fIid\fR\|);
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#f\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\*`\fI\v'0.25m'*\v'-0.25m'\fR\^\*' \fIid\fR:\*<identifier\*> }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fIP\fR := \fICURRENT\*_ENV\fR.\fIbinding\fR\^(\fIid\fR\|);
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#g\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\*`\fI<\fR\^\*' \fIcurs\fR1:\*<integer-constant\*> \*`\fI,\fR\^\*'
                          \ju\fIexpr\fR1:\*<expression\*> \*`\fI,\fR\^\*' \fIP\fR:\*<pattern\*> \*`\fI>\fR\^\*' }}        \jv
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR2, \fIexpr\fR2, \fIP\fR1] := \fImatch\fR\^(\fIinteger\fR\^(\fIcurs\fR1), \fIexpr\fR1, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR2, \fIexpr\fR2, \fIP\fR1]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#h\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\s-2IMSBAS\s0 \jw\*`\fI\z( \jt\fR\^\*' \fIP\fR:\*<pattern-primary\*> \*`\fI,\fR\^\*' \fIid\fR:\*<identifier\*> \*`\fI)\fR\^\*' }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fICURRENT\*_ENV\fR.\fIbind\fR\^(\fIid\fR, \fImk\*_string\fR\^(\fIcurs\fR, \fIcurs\fR1));
\h'|\nnu'\fIrpat\fR1 := \fImk\*_comp\fR\^(\fIcurs\fR, \fIexpr\fR, \fImk\*_imsbas\fR\^(\fIP\fR1, \fIid\fR\|));
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR1, \fIrpat\fR1]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#i\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\s-2CDSBAS\s0 \jw\*`\fI\z( \jt\fR\^\*' \fIP\fR:\*<pattern-primary\*> \*`\fI,\fR\^\*' \fIid\fR:\*<identifier\*> \*`\fI)\fR\^\*' }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fBif\fR \jn[\fIcurs\fR1, \fIexpr\fR1, \fIP\fR1] := \fImatch\fR\^(\fIcurs\fR, \fIexpr\fR, \fIP\fR)
\h'|\nlu'\fBthen\fR
\h'|\nnu'\fIexpr\fR2 := \fImk\*_expr\fR\^(\fIexpr\fR1, \fImk\*_assign\fR\^(\fIid\fR, \fImk\*_string\fR\^(\fIcurs\fR, \fIcurs\fR1)));
\h'|\nnu'\fIrpat\fR1 := \fImk\*_comp\fR\^(\fIcurs\fR, \fIexpr\fR, \fImk\*_cdsbas\fR\^(\fIP\fR1, \fIid\fR\|));
\h'|\nnu'\fIreturn\fR\^(\^[\fIcurs\fR1, \fIexpr\fR2, \fIrpat\fR1]\^)
\h'|\nlu'\fBelse\fR
\h'|\nnu'\fIfreturn\fR
\h'|\nlu'\fBfi\fR
\*#j\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\s-2IMACT\s0 \jx\*`\fI\z( \jt\fR\^\*' \fIexpr\fR1:\*<expression\*> \*`\fI)\fR\^\*' }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fIeval\fR\^(\fIexpr\fR1);
\h'|\nlu'\fIreturn\fR\^(\^[\fIcurs\fR, \fIexpr\fR, \fInull\fR\|]\^)
\*#k\jk\*#\h'|\niu'\fBelif\fR \jp{{ \fIpat\fR =\h'-0.3m'= \jq\s-2CDACT\s0 \jx\*`\fI\z( \jt\fR\^\*' \fIexpr\fR1:\*<expression\*> \*`\fI)\fR\^\*' }}
\h'|\niu'\fBthen\fR
\h'|\nlu'\fIreturn\fR\^(\^[\fIcurs\fR, \fImk\*_expr\fR\^(\fIexpr\fR, \fIexpr\fR1), \fInull\fR\|]\^)
\*#l\jk\*#\h'|\niu'\fBelse\fR
\h'|\nlu'\fIERROR\fR
\h'|\niu'\fBfi\fR
\h'|\ngu');
.}}
