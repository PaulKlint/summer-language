.iy I BEGIN
.iy I CLASS
.iy I END
.iy I ENV
.iy I ERROR
.iy I FETCH
.iy I INIT
.iy I N
.iy I STATE
.iy I STORE
.iy I binding
.iy I class_decl
.iy I dereference
.iy I eval_call
.iy I eval_field_selection
.iy I is_loc
.iy I modify
.iy I operation
.iy I size
.iy I string_equal
.iy I text
.{{
\fBproc\fR \jg\fIeval\*_field\*_selection\fR\^(\fIaccess\*_type\fR, \fIinstance\fR, \fIfield\fR, \fIactuals\fR)
\z(  \jh\fBvar\fR \ji\fIflist\fR, \fIslist\fR, \fIlist\fR, \fIv\fR, \fIsig\fR, \fIf\fR, \fIENV\fR1, \fIp\fR, \fIa\fR;
.sp 0.5
\h'|\nhu'\fBif\fR \jg\fIis\*_basic\*_instance\fR\^(\fIinstance\fR)
\h'|\nhu'\fBthen\fR
\h'|\ngu'\fIreturn\fR\^(\fIinstance\fR.\fIoperation\fR\^(\|\|\fIfield\fR, \fIactuals\fR))
\h'|\nhu'\fBfi\fR;
\h'|\nhu'\fBif\fR \jg\(ap \fIis\*_composite\*_instance\fR\^(\fIinstance\fR) \fBthen\fR \jj\fIERROR\fR \fBfi\fR;
\h'|\nhu'{{ \fIinstance\fR.\fIclass\*_decl\fR.\fItext\fR =\h'-0.3m'=
           \jk\s-2CLASS\s0 \jl\*<identifier\*> \*<formals\*>
\h'|\nku'\s-2BEGIN\s0 \jl\s-2FETCH\s0 \jm\fIflist\fR:{\*<association\*> \*`\fI,\fR\^\*'}+ \*`\fI;\fR\^\*'
\h'|\nlu'\s-2STORE\s0 \jm\fIslist\fR:{\*<association\*> \*`\fI,\fR\^\*'}+ \*`\fI;\fR\^\*'
\h'|\nlu'(  \jn\*<variable-declaration\*> | \*<constant-declaration\*> |
\h'|\nnu'\*<procedure-declaration\*> | \*<operator-declaration\*>
\h'|\nlu')\v'0.25m'*\v'-0.25m'
\h'|\nlu'[\s-2INIT\s0 \jm\*`\fI:\fR\^\*' \*<block\*>]
\h'|\nku'\s-2END\s0 \jo\*<identifier\*> \*`\fI;\fR\^\*'
\h'|\nhu'}};
\h'|\nhu'\fIENV\fR1 := \fIENV\fR;
\h'|\nhu'\fIENV\fR := \fIinstance\fR.\fIenv\fR;
\h'|\nhu'\fIlist\fR := \fBif\fR \jp\fIaccess\*_type\fR = \*`\fI\h'-0.1m'fetch\fR\^\*' \fBthen\fR \jq\fIflist\fR \fBelse\fR \jr\fIslist\fR \fBfi\fR;
\h'|\nhu'\fBfor\fR \ji\fIa\fR \fBin\fR \jk\fIlist\fR
\h'|\nhu'\fBdo\fR \jg\fBif\fR \js{{ \fIa\fR =\h'-0.3m'= \jt\fIf\fR:\*<field-identifier\*> }} & \fIstring\*_equal\fR\^(\|\|\fIfield\fR, \fIf\fR\|\|)
\h'|\ngu'\fBthen\fR
\h'|\nsu'\fBif\fR \jk\fIis\*_loc\fR\^(\fIENV\fR.\fIbinding\fR\^(\|\|\fIf\fR\|\|))
\h'|\nsu'\fBthen\fR
\h'|\nku'\fBif\fR \ju\fIaccess\*_type\fR = \*`\fI\h'-0.1m'fetch\fR\^\*'
\h'|\nku'\fBthen\fR
\h'|\nuu'\fBif\fR \jl\fIactuals\fR.\fIsize\fR \(ap\h'-0.2m'= 0 \fBthen\fR \jq\fIERROR\fR \fBfi\fR;
\h'|\nuu'\fIv\fR := \fIdereference\fR\^(\fIENV\fR.\fIbinding\fR\^(\|\|\fIf\fR\|\|));
\h'|\nuu'\fIENV\fR := \fIENV\fR1;
\h'|\nuu'\fIreturn\fR\^(\^[\fIv\fR, \fIN\fR\|]\^)
\h'|\nku'\fBelse\fR
\h'|\nuu'\fBif\fR \jl\fIactuals\fR.\fIsize\fR \(ap\h'-0.2m'= 1 \fBthen\fR \jq\fIERROR\fR \fBfi\fR;
\h'|\nuu'\fIv\fR := \fIactuals\fR\^[0];
\h'|\nuu'\fISTATE\fR.\fImodify\fR\^(\fIENV\fR.\fIbinding\fR\^(\|\|\fIf\fR\|\|), \fIv\fR);
\h'|\nuu'\fIENV\fR := \fIENV\fR1;
\h'|\nuu'\fIreturn\fR\^(\^[\fIv\fR, \fIN\fR\|]\^)
\h'|\nku'\fBfi\fR
\h'|\nsu'\fBelse\fR
\h'|\nku'\fBif\fR \ju\fIaccess\*_type\fR = \*`\fI\h'-0.1m'fetch\fR\^\*'
\h'|\nku'\fBthen\fR
\h'|\nuu'[\fIv\fR, \fIsig\fR] := \fIeval\*_call\fR\^(\|\|\fIf\fR, \fIactuals\fR);
\h'|\nuu'\fIENV\fR := \fIENV\fR1;
\h'|\nuu'\fIreturn\fR\^(\^[\fIv\fR, \fIsig\fR]\^)
\h'|\nku'\fBelse\fR
\h'|\nuu'\fIERROR\fR
\h'|\nku'\fBfi\fR
\h'|\nsu'\fBfi\fR;
\h'|\ngu'\fBelif\fR \jv{{ \fIa\fR =\h'-0.3m'= \jw\fIf\fR:\*<field-identifier\*> \*`\fI:\fR\^\*' \fIp\fR:\*<identifier\*> }} &
\h'|\nvu'\fIstring\*_equal\fR\^(\|\|\fIfield\fR, \fIf\fR\|\|)
\h'|\ngu'\fBthen\fR
\h'|\nvu'[\fIv\fR, \fIsig\fR] := \fIeval\*_call\fR\^(\^\fIp\fR, \fIactuals\fR);
\h'|\nvu'\fIENV\fR := \fIENV\fR1;
\h'|\nvu'\fIreturn\fR\^(\^[\fIv\fR, \fIsig\fR]\^)
\h'|\ngu'\fBfi\fR
\h'|\nhu'\fBod\fR;
\h'|\nhu'\fIERROR\fR
);
.}}
.iy I BEGIN
.iy I CLASS
.iy I END
.iy I ENV
.iy I ERROR
.iy I FETCH
.iy I INIT
.iy I N
.iy I STATE
.iy I STORE
.iy I binding
.iy I class_decl
.iy I dereference
.iy I eval_call
.iy I eval_field_selection
.iy I is_loc
.iy I modify
.iy I operation
.iy I size
.iy I string_equal
.iy I text
